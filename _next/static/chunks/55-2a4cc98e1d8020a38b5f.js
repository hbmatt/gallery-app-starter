(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[55],{5055:function(e,t,n){"use strict";n.d(t,{Z:function(){return D}});var r=n(5893),c=n(7294),a=n(9514),s=n(7757),i=n.n(s),l=n(2137),o=n(8229),u=function(e,t,n){var r=(0,c.useState)(0),a=r[0],s=r[1],u=(0,c.useState)(null),d=u[0],f=u[1],p=(0,c.useState)(null),m=p[0],h=p[1];return(0,c.useEffect)((function(){var r=o.vY.ref(e.name),c=o.H1.collection(t),a=o.H1.collection("GalleryThumbnails");r.put(e).on("state_changed",(function(e){var t=e.bytesTransferred/e.totalBytes*100;s(t)}),(function(e){f("Images already exists. Could not upload.")}),(0,l.Z)(i().mark((function e(){var s,l,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getDownloadURL();case 2:return s=e.sent,l=(0,o.AB)(),c.add({url:s,createdAt:l}),h(s),e.next=8,a.doc(t).get();case 8:if(!(u=e.sent)||!u.exists){e.next=13;break}return e.abrupt("return");case 13:a.doc(t).set({url:s,galleryUrl:"/"+t.toLowerCase().replace("images",""),galleryName:n});case 14:case 15:case"end":return e.stop()}}),e)}))))}),[e,t,n]),{progress:a,url:m,error:d}},d=n(1770),f=function(e){var t=e.file,n=e.setFile,a=e.setError,s=e.gallery,i=e.galleryName,l=u(t,s,i),o=l.url,f=l.progress,p=l.error;return(0,c.useEffect)((function(){o&&(n(null),a(null)),p&&(a(p),n(null))}),[o,n,p,a]),(0,r.jsx)(d.E.div,{className:"progress-bar",initial:{width:0},animate:{width:f+"%"}})},p=n(7625),m=n(1436),h=function(e){var t=e.gallery,n=e.galleryName,a=e.error,s=e.setError,i=(0,c.useState)(null),l=i[0],o=i[1],u=["image/png","image/jpeg"];return(0,r.jsx)("div",{className:"upload-form",children:(0,r.jsxs)("form",{children:[(0,r.jsxs)("label",{children:[(0,r.jsx)("input",{type:"file",onChange:function(e){var t=e.target.files[0];t&&u.includes(t.type)?(o(t),s("")):(o(null),s("Please select an image file (png or jpg)"))}}),(0,r.jsx)(p.G,{icon:m.KtF})]}),(a||l)&&(0,r.jsxs)("div",{className:"output",children:[a&&(0,r.jsx)("div",{className:"error",children:a}),l&&(0,r.jsx)("div",{className:"filename",children:l.name}),l&&(0,r.jsx)(f,{file:l,setFile:o,setError:s,gallery:t,galleryName:n})]})]})})},g=n(6156);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){(0,g.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var x=function(e){var t=(0,c.useState)([]),n=t[0],r=t[1];return(0,c.useEffect)((function(){var t=o.H1.collection(e).orderBy("createdAt","desc").onSnapshot((function(e){var t=[];e.forEach((function(e){t.push(v(v({},e.data()),{},{id:e.id}))})),r(t)}));return function(){return t()}}),[e]),{docs:n}},y=function(e){var t=e.gallery,n=e.setSelectedImg,c=e.setError,a=x(t).docs;return(0,r.jsx)("div",{className:"img-grid",children:a&&a.map((function(e){return(0,r.jsx)(d.E.div,{className:"img-wrap",layout:!0,whileHover:{opacity:1},onClick:function(){c(""),n({url:e.url,id:e.id})},children:(0,r.jsx)(d.E.img,{src:e.url,alt:"uploaded pic",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5}})},e.id)}))})},b=n(6914),E=function(e){var t=(0,c.useState)(!1),n=t[0],r=t[1];function a(t){t.key===e&&r(!0)}var s=function(t){t.key===e&&r(!1)};return(0,c.useEffect)((function(){return window.addEventListener("keydown",a),window.addEventListener("keyup",s),function(){window.removeEventListener("keydown",a),window.removeEventListener("keyup",s)}}),[]),n},w=function(e){var t=e.name,n=e.setName,s=(0,c.useContext)(a.V).currentUser,i=(0,c.useState)(!1),l=i[0],o=i[1],u=(0,c.useState)(t),d=u[0],f=u[1],p=(0,c.useRef)(null),m=(0,c.useCallback)((function(){return o(!0)}),[o]),h=E("Escape"),g=E("Enter");return(0,c.useEffect)((function(){l&&""===d.trim()?(g||h)&&(f(t),o(!1)):l&&""!=d.trim()&&(g&&(n(d),o(!1)),h&&(f(t),o(!1)))}),[g,h]),(0,c.useEffect)((function(){l&&p.current.focus()}),[l]),(0,r.jsxs)(r.Fragment,{children:[s&&(0,r.jsxs)("div",{className:"name".concat(l?"--input":""),children:[(0,r.jsx)("span",{className:"name--".concat(l?"hidden":"active"),onClick:m,children:d}),(0,r.jsx)("input",{className:"name-input--".concat(l?"active":"hidden"),type:"text",ref:p,value:d,onChange:function(e){return f(e.target.value)}})]}),!s&&(0,r.jsx)("div",{className:"name",children:t})]})},O=function(e){var t=e.selectedImg,n=e.setSelectedImg,s=e.gallery,u=e.setError,f=(0,c.useContext)(a.V).currentUser,h=E("Escape");(0,c.useEffect)((function(){h&&n(null)}),[h]);return(0,r.jsxs)(d.E.div,{className:"backdrop",onClick:function(e){(e.target.classList.contains("backdrop")||e.target.classList.contains("close-button"))&&n(null)},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[(0,r.jsxs)(d.E.div,{className:"image-modal-wrap",initial:{y:"-100vh"},animate:{y:0},transition:{type:"spring",duration:.5},exit:{y:"-100vh"},children:[(0,r.jsx)("img",{src:t.url,alt:"Enlarged pic"}),(0,r.jsx)(w,{name:t.name||t.url.split(/(\/o\/)(..*)(\?alt)/)[2].split(".")[0],setName:function(e){o.H1.collection(s).doc(t.id).set({name:e},{merge:!0})}})]}),(0,r.jsxs)("div",{className:"buttons",children:[(0,r.jsx)("div",{className:"close-button"}),f&&(0,r.jsx)("div",{className:"delete",onClick:function(e){window.confirm("Delete the image?")&&function(e,t,r){var c=o.H1.collection(r),a=o.H1.collection("GalleryThumbnails"),s=c.doc(e),d=o.vY.refFromURL(t);!function(){var e=(0,l.Z)(i().mark((function e(){var l,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n(null),e.next=3,a.doc(r).get();case 3:if(e.sent.data().url!==t){e.next=18;break}return s.delete().then().catch((function(e){return u("Image could not be deleted.")})),d.delete().then().catch((function(e){return u("Image could not be deleted.")})),e.next=10,c.orderBy("createdAt","asc").limit(1).get();case 10:return l=e.sent,o="",l.forEach((function(e){return o=e.data().url})),e.next=15,a.doc(r).update({url:o});case 15:u(""),e.next=19;break;case 18:s.delete().then((function(){d.delete().then((function(){n(null),u("")})).catch((function(e){u("Image could not be deleted.")}))})).catch((function(e){u("Image could not be deleted.")}));case 19:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()()}(t.id,t.url,s)},children:(0,r.jsx)(p.G,{icon:m.$aW})})]})]})},N=n(3869);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,g.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var S=function(e){var t=(0,c.useState)({}),n=t[0],r=t[1];return(0,c.useEffect)((function(){o.H1.collection("CharacterDescriptions").doc(e).get().then((function(e){e.exists&&r(C(C({},e.data()),{},{id:e.id}))}))}),[e]),{doc:n}},P=function(e){var t=e.character,n=(0,c.useContext)(a.V).currentUser,s=S(t).doc.description,i=(0,c.useState)(!1),l=i[0],u=i[1],d=(0,c.useState)(),f=d[0],p=d[1];(0,c.useEffect)((function(){p(s)}),[s]);var m=(0,c.useRef)(null),h=(0,c.useCallback)((function(){return u(!0)}),[u]),g=E("Escape"),j=E("Enter");return(0,c.useEffect)((function(){l&&""===f.trim()?(j||g)&&(p(s),u(!1)):l&&""!=f.trim()&&(j&&(!function(e){o.H1.collection("CharacterDescriptions").doc(t).set({description:e},{merge:!0})}(f),u(!1)),g&&(p(s),u(!1)))}),[j,g]),(0,c.useEffect)((function(){l&&m.current.focus()}),[l]),(0,r.jsxs)(r.Fragment,{children:[n&&(0,r.jsx)("div",{className:"desc",children:(0,r.jsxs)("p",{children:[(0,r.jsx)("span",{className:"desc--".concat(l?"hidden":"active"),onClick:h,children:f||"Click to enter description."}),(0,r.jsx)("textarea",{className:"desc-input--".concat(l?"active":"hidden"),type:"text",ref:m,value:f,onChange:function(e){return p(e.target.value)}})]})}),!n&&s&&(0,r.jsx)("div",{className:"desc",children:(0,r.jsx)("p",{children:s})})]})},D=function(e){var t=e.gallery,n=e.title,s=(0,c.useState)(null),i=s[0],l=s[1],o=(0,c.useState)(null),u=o[0],d=o[1],f=(0,c.useContext)(a.V).currentUser;return(0,r.jsxs)("div",{className:"content",children:[(0,r.jsx)(b.Z,{title:n}),f&&(0,r.jsx)(h,{gallery:t,galleryName:n,error:u,setError:d}),(0,r.jsx)(P,{character:n.toLowerCase()}),(0,r.jsx)(y,{gallery:t,setSelectedImg:l,setError:d}),(0,r.jsx)(N.M,{children:i&&(0,r.jsx)(O,{selectedImg:i,setSelectedImg:l,gallery:t,setError:d})})]})}},6914:function(e,t,n){"use strict";var r=n(5893),c=n(7294),a=n(9514),s=n(8229),i=n(1664),l=n(9008);t.Z=function(e){var t=e.title,n=(0,c.useContext)(a.V).currentUser;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.default,{children:(0,r.jsx)("title",{children:t})}),(0,r.jsx)("div",{className:"title",children:(0,r.jsx)("h1",{children:(0,r.jsx)(i.default,{href:"/",children:(0,r.jsx)("a",{children:t})})})}),(0,r.jsxs)("div",{className:"nav",children:[(0,r.jsx)(i.default,{href:"/",children:(0,r.jsx)("button",{children:"home"})}),!n&&(0,r.jsx)(i.default,{href:"/login",children:(0,r.jsx)("button",{children:"sign in"})}),n&&(0,r.jsx)("button",{onClick:function(e){s.QK.signOut()},children:"sign out"})]})]})}}}]);